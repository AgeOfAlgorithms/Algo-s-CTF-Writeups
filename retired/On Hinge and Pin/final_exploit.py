#!/usr/bin/env python3
"""
Author: Claude Code
Purpose: Decrypt the flag from enc_flag.bin using XOR cipher
Assumptions: The key is "ONOFFONOFF" as found in Crypto.java
Time of creation: 2025-11-10
Expected result: The decrypted flag in plaintext
Produced result: poctf{uwsp_c4nc3l_c0u7ur3} - SUCCESS!
"""

def decrypt_flag(encrypted_file, key):
    """
    Decrypt the flag using XOR cipher with repeating key.

    Args:
        encrypted_file: Path to the encrypted flag file
        key: The XOR key as a string

    Returns:
        The decrypted flag as a string
    """
    # Read encrypted data
    with open(encrypted_file, 'rb') as f:
        encrypted_data = f.read()

    # Convert key to bytes
    key_bytes = key.encode('utf-8')

    # Decrypt by XORing each byte with the corresponding key byte
    decrypted = bytearray()
    for i in range(len(encrypted_data)):
        decrypted.append(encrypted_data[i] ^ key_bytes[i % len(key_bytes)])

    # Convert to string
    return decrypted.decode('utf-8')

if __name__ == "__main__":
    # The key from Crypto.java
    KEY = "ONOFFONOFF"

    # Path to encrypted flag
    encrypted_file = "apk_extracted/assets/enc_flag.bin"

    # Decrypt and print the flag
    flag = decrypt_flag(encrypted_file, KEY)
    print(f"Decrypted flag: {flag}")
